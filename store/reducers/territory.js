import {
  FETCH_TERRITORIES,
  SAVE_TERRITORY_SUCCESS,
  DELETE_TERRITORIES
} from '../actions/territory';
import Territory from '../../models/territory';
import * as testData from '../../fake-data/fake-data';

const initialState = [
  {
    id: '-LwQXgfP8s3ZPuxOQgNW',
    coords: [
      [47.629575540776266, -122.34805461019279],
      [47.62746193665442, -122.34779042714008],
      [47.62728761823703, -122.34753144625348],
      [47.626882386074996, -122.3462427389236],
      [47.628002455563475, -122.34716847538948],
      [47.628002455563475, -122.3504501581192],
      [47.62747891584773, -122.35363016233907],
      [47.626430678783414, -122.35641773790121],
      [47.62534338529636, -122.3585804757921],
      [47.62498980132824, -122.35903943335697],
      [47.624086257422285, -122.36001458019017],
      [47.62398004982044, -122.36060734838247],
      [47.62290277104626, -122.36125316286065],
      [47.61998400149665, -122.3623464256525],
      [47.618937089068076, -122.36271692591154],
      [47.61787952979395, -122.36250400543213],
      [47.61566739283783, -122.36202992498875],
      [47.61356297340805, -122.36108142882587],
      [47.61271064927247, -122.35985565930605],
      [47.611408615523665, -122.35831091528931],
      [47.61121797497035, -122.35780142247677],
      [47.609864658940786, -122.35385407789742],
      [47.61026033713699, -122.35123457929967],
      [47.610262751058, -122.35123058894112],
      [47.61017800513965, -122.35293958336115],
      [47.61017800513965, -122.35515274107458],
      [47.6104873328163, -122.35650320881821],
      [47.61007199531689, -122.35546957701445],
      [47.60985952295702, -122.35388807952404],
      [47.609864658940786, -122.35385407789742],
      [47.61121797497035, -122.35780142247677],
      [47.611408615523665, -122.35831091528931],
      [47.61097444312556, -122.3577958094291],
      [47.61081835414786, -122.35732700675727],
      [47.6104873328163, -122.35650320881821],
      [47.61017800513965, -122.35515274107458],
      [47.61017800513965, -122.35293958336115],
      [47.610262751058, -122.35123058894112],
      [47.61036674277836, -122.35105868428946],
      [47.61046101410847, -122.34990604249771],
      [47.61049829363988, -122.34965924173594],
      [47.61085358200303, -122.3474720729229],
      [47.611538031073984, -122.34511423856019],
      [47.61292288402756, -122.34373055398466],
      [47.61337202090501, -122.34356050417136],
      [47.61343165627493, -122.34354849904777],
      [47.61345727736652, -122.34352822482381],
      [47.614175028948374, -122.34325647354126],
      [47.616173200284564, -122.3429399728775],
      [47.61966399708535, -122.3429399728775],
      [47.622301941072244, -122.34309755265713],
      [47.62461842205012, -122.3438884690404],
      [47.62672420422956, -122.3466943949461],
      [47.62728761823703, -122.34753144625348],
      [47.62736525445746, -122.34777834266424],
      [47.62746193665442, -122.34779042714008],
      [47.62778870031364, -122.34827589243652],
      [47.62778870031364, -122.3542045801878],
      [47.626430678783414, -122.35827550292015],
      [47.625044601790215, -122.36060734838247],
      [47.62390192857755, -122.36095039344073],
      [47.62398004982044, -122.3607649281621],
      [47.62472621014935, -122.35938157886268],
      [47.62498980132824, -122.35903943335697],
      [47.62525836826225, -122.35874958336353],
      [47.62534338529636, -122.3585804757921],
      [47.62557833843034, -122.35827550292015],
      [47.626324475944955, -122.35669400542974],
      [47.62715014084083, -122.35562715679409],
      [47.62747891584773, -122.35363016233907]
    ],
    dateCreated: 1576715078146,
    dateModified: 1576715078146,
    runs: ['-LwQXgfP8s3ZPuxOQgOP'],
    userId: 'user3'
  }
  // {
  //   id: '-LwUN6fFACaGAHHUAkPP',
  //   coords: testData.selfCrossing.superCrossed,
  //   dateCreated: 1576779413035,
  //   dateModified: 1576779413035,
  //   runs: ['-LwUN6dwI4UV3h5LzGQL'],
  //   userId: 'user3'
  // }
];

export default (state = initialState, action) => {
  switch (action.type) {
    case SAVE_TERRITORY_SUCCESS:
      const newTer = new Territory(
        action.newTerritory.id,
        action.newTerritory.userId,
        action.newTerritory.coords,
        action.newTerritory.dateCreated,
        action.newTerritory.dateModified,
        action.newTerritory.runs
      );
      return [...state, newTer];

    case FETCH_TERRITORIES:
      if (!Object.keys(action.territories).length) return state;
      const newTerrs = Object.keys(action.territories).map(key => {
        const terr = action.territories[key];
        return new Territory(
          key,
          terr.userId,
          terr.coords,
          terr.dateCreated,
          terr.dateModified,
          terr.runs
        );
      });
      return [...state, ...newTerrs];

    case DELETE_TERRITORIES:
      const newState = state.filter(
        ter => !action.deleteResults.includes(ter.id)
      );
      return [...newState];

    default:
      return state;
  }
};
